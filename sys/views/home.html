<div class="container-xs-height full-height">
  <div class="row-xs-height">
    <div class="col-xs-height col-middle">
      <div class="error-container text-center">
        <h1 class="error-number" id="username"></h1>
        <h1 class="error-number">No Home App</h1>
        <p>You have no <b>Home</b> app installed. You can download one online or sideload an already-downloaded copy.
        </p>
        <button class="btn btn-block btn-info btn-cons m-b-10" type="button" id="download">
            <i class="fa fa-cloud-download"></i> 
            <span class="bold">Download (from npm)</span>
        </button>
        <button class="btn btn-block btn-info btn-cons m-b-10" type="button" id="sideload">
            <i class="fa fa-copy"></i> 
            <span class="bold">Sideload (ensure it is first copied to the node_modules folder)</span>
        </button>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        //get current user
        $.ajax({
          url: "{{protocol}}://{{host}}:{{port}}/api/users/@current",
          type: "GET",
          headers: {'X-Bolt-App-Token': '{{appToken}}'},
          success: function(response, status, xhr){
            if(response.code == 0){
              var user = response.body;
              if(user) $("#username").html("Welcome " + user.displayName);
            }
            else {
              sweetAlert(response.errorUserTitle, response.errorUserMessage, "error");
            }
          },
          error: function(xhr, status, err){
            alert(xhr.responseText);
          }
        });

        $("#download").click(function(){
            $.ajax({
              url: "{{protocol}}://{{host}}:{{port}}/api/apps",
              data: { name: "bolt-home" },
              type: "POST",
              headers: {'X-Bolt-App-Token': '{{appToken}}'},
              success: function(response, status, xhr){
                if(response.code == 0){
                  window.location.href="{{protocol}}://{{host}}:{{port}}/Home";
                }
                else {
                  sweetAlert(response.errorUserTitle, response.errorUserMessage, "error");
                }
              },
              error: function(xhr, status, err){
                alert(xhr.responseText);
              }
            });
        });

        $("#sideload").click(function(){
            $.ajax({
              url: "{{protocol}}://{{host}}:{{port}}/api/apps/reg",
              data: { path: "bolt-home" },
              type: "POST",
              headers: {'X-Bolt-App-Token': '{{appToken}}'},
              success: function(response, status, xhr){
                if(response.code == 0){
                  window.location.href="{{protocol}}://{{host}}:{{port}}/Home";
                }
                else {
                  sweetAlert(response.errorUserTitle, response.errorUserMessage, "error");
                }
              },
              error: function(xhr, status, err){
                alert(xhr.responseText);
              }
            });
        });
      });
</script>